@page "/Medarbejdere"
@using Core
@using EksamensProjekt.Service
@inject ILogin LoginService
@inject NavigationManager nav
@inject IUser mService


<h3>Oversigt over Medarbejder</h3>
@foreach (var user in users)
{
    <div class="employee-card" @onclick="@(() => nav.NavigateTo($"/StudentplanPage/{user.UserId}"))">
        <div class="employee-info">
            <img src="https://static.independent.co.uk/2024/05/24/13/Gordon.jpg?width=1200&height=1200&fit=crop" alt="">
            <h2>@user.Name</h2>
            <span>@user.Role </span>
            <span>Hotel:Aarhus</span>
            @if (currentUser?.Role == "Admin")
            {
                <td><button class="btn-primary" @onclick="() => DeleteById(user)">Fjern bruger</button></td>
            }
        </div>
        <div class="employee-progress">
            <div class="employee-progress-bar">
            </div>
        </div>
    </div>
}


@code {
    private User? currentUser;

    private User[]? users = new User[0];
    
    protected override async Task OnInitializedAsync()
    {
        currentUser = await LoginService.GetUserLoggedIn();

        if (currentUser == null ||
            (currentUser.Role != "Admin" && currentUser.Role != "KÃ¸kkenchef"))
        {
            nav.NavigateTo("/");
            return;
        }

        await LoadAll();
    }
    
    private async Task DeleteById(User user)
    {
        await mService.DeleteById(user.UserId);
        await LoadAll();

    }

    private void AddUser()
    {
        nav.NavigateTo("CreateUserPage");  
    }
    
    private async Task LoadAll()
    {
        users = await mService.GetAll();
        users = users.Where(e => e.Role != "Elev").ToArray();
    }
}